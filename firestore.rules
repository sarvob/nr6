rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // Filings collection - public can create (after payment), only admin can read/update
    match /filings/{filingId} {
      // Allow anyone to create a filing (for form submissions)
      allow create: if true;
      
      // Allow read/write for authenticated admin users
      allow read, update, delete: if request.auth != null && 
        exists(/databases/$(database)/documents/admins/$(request.auth.uid));
    }
    
    // Contact submissions - public can create, only admin can read/update
    match /contact_submissions/{submissionId} {
      // Allow anyone to submit a contact form
      allow create: if true;
      
      // Allow read/write for authenticated admin users
      allow read, update, delete: if request.auth != null && 
        exists(/databases/$(database)/documents/admins/$(request.auth.uid));
    }
    
    // Mail collection - for Firebase Trigger Email extension
    // Public can create (to send emails), extension handles the rest
    match /mail/{mailId} {
      allow create: if true;
      allow read, update, delete: if false; // Only extension should read/update
    }
    
    // Admins collection - only the user themselves can read their admin status
    match /admins/{userId} {
      allow read: if request.auth != null && request.auth.uid == userId;
      allow write: if false; // Only manage through Firebase Console
    }
  }
}
